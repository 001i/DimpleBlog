<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link href="/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="/css/animate.css" rel="stylesheet">
    <link href="/css/style.css?v=4.1.0" rel="stylesheet">
    <!--IOS风格切换插件-->
    <link href="/css/switchery/switchery.css" rel="stylesheet">
    <script src="/js/switchery/switchery.js"></script>

</head>
<body>
<div class="ibox float-e-margins">
    <div class="ibox-content">
        <form class="form-horizontal m-t" id="updateLinksFrom">
            <input type="hidden" name="linkId" th:value="${linkInfo.data.linkId}">
            <div class="form-group">
                <label class="col-sm-3 control-label">名称：</label>
                <div class="col-sm-8">
                    <input id="linkTitle" name="title" th:value="${linkInfo.data.title}" type="text"
                           class="form-control"
                           required="" aria-required="true">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">描述：</label>
                <div class="col-sm-8">
                    <input id="linkDescription" th:value="${linkInfo.data.description}" type="text" class="form-control"
                           name="description" required=""
                           aria-required="true">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">链接地址：</label>
                <div class="col-sm-8">
                    <input id="linkUrl" th:value="${linkInfo.data.url}" class="form-control" name="url" required="">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">是否显示：</label>
                <div class="col-sm-8">
                    <input type="checkbox" class="js-switch" th:checked="${linkInfo.data.display}"/>
                    <input id="display" type="hidden" name="display" th:value="${linkInfo.data.display}">
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-3 control-label">权重：</label>
                <div class="col-sm-8">
                    <input id="linkWeight" th:value="${linkInfo.data.weight}" class="form-control" name="weight">
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-4 col-sm-offset-3">
                    <button class="btn btn-primary" id="linkUpdateSubmit" type="submit">提交</button>
                </div>
            </div>
        </form>
    </div>

    <!-- 全局js -->
    <script src="/js/jquery.min.js?v=2.1.4"></script>
    <script src="/js/bootstrap.min.js?v=3.3.6"></script>

    <!-- 自定义js -->
    <script src="/js/content.js?v=1.0.0"></script>

    <!-- jQuery Validation plugin javascript-->
    <script src="/js/validate/jquery.validate.min.js"></script>
    <script src="/js/validate/messages_zh.min.js"></script>
    <script src="/js/switchery/switchery.js"></script>
    <script src="/js/validate/validate-index.js"></script>
    <script>
        $(function () {
            function hh() {
                console.log(111);
            }
            //link 提交按钮点击事件
            $("#linkUpdateSubmit").click(function () {
                $.ajax({
                    type: "PUT",
                    dataType: "json",
                    data: $("#updateLinksFrom").serializeArray(),
                    url: "/links",
                    success: function (data) {
                        if (data != null && data.code == 200) {
                            parent.layer.msg('修改成功！', {icon: 1});
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);//关闭当前页
                            $("#bootstrap-table").bootstrapTable('refresh', {
                                silent: true
                            });
                        } else {
                            layer.alert('修改失败！', {
                                icon: 5,
                                skin: 'layer-ext-moon'
                            });
                        }
                    }
                });
                return false;
            });
            //Switchery按钮初始化
            var elem = document.querySelector('.js-switch');
            var init = new Switchery(elem, {color: '#7c8bc7', jackColor: '#9decff'});
            elem.onchange = function () {
                var isChecked = elem.checked;
                $("#display").val(isChecked);
            };

            $("#form-user-edit").validate({
                rules: {
                    userName: {
                        required: true,
                    },
                    email: {
                        required: true,
                        email: true,
                        remote: {
                            url:"system/user/checkEmailUnique",
                            type: "post",
                            dataType: "json",
                            data: {
                                "userId": function () {
                                    return $("input[name='userId']").val();
                                },
                                "email": function () {
                                    return $("input[name='email']").val();
                                }
                            },
                            dataFilter: function (data, type) {
                                if (data == "0") return true;
                                else return false;
                            }
                        }
                    },
                    phonenumber: {
                        required: true,
                        isPhone: true,
                        remote: {
                            url: "system/user/checkPhoneUnique",
                            type: "post",
                            dataType: "json",
                            data: {
                                "userId": function () {
                                    return $("input[name='userId']").val();
                                },
                                "phonenumber": function () {
                                    return $("input[name='phonenumber']").val();
                                }
                            },
                            dataFilter: function (data, type) {
                                if (data == "0") return true;
                                else return false;
                            }
                        }
                    },
                },
                messages: {
                    "email": {
                        remote: "Email已经存在"
                    },
                    "phonenumber": {
                        remote: "手机号码已经存在"
                    }
                },
                submitHandler: function (form) {
                    $.ajax({
                        type: "PUT",
                        dataType: "json",
                        data: $("#updateLinksFrom").serializeArray(),
                        url: "/links",
                        success: function (data) {
                            if (data != null && data.code == 200) {
                                parent.layer.msg('修改成功！', {icon: 1});
                                var index = parent.layer.getFrameIndex(window.name);
                                parent.layer.close(index);//关闭当前页
                                $("#bootstrap-table").bootstrapTable('refresh', {
                                    silent: true
                                });
                            } else {
                                layer.alert('修改失败！', {
                                    icon: 5,
                                    skin: 'layer-ext-moon'
                                });
                            }
                        }
                    });
                    return false;
                }
            });
        });
    </script>
</div>
</body>
</html>